---
import MainLayout from "@src/layouts/MainLayout.astro";
import TourCard from "@src/components/TourCard.astro";
import Pagination from "@src/components/Pagination.astro";

import { getCollection } from "astro:content";
import type { GetStaticPaths } from "astro";
import HeadingSection from "@src/components/HeadingSection.astro";

export const getStaticPaths = (async () => {
  const countries = await getCollection("countries");
  const maxPerPage = 8;
  const totalPages = Math.ceil(countries.length / maxPerPage);

  return Array.from({ length: totalPages }, (_, i) => ({
    params: { page: String(i + 1) },
  }));
}) satisfies GetStaticPaths;

const currentPage = Number(Astro.params.page);
const maxPerPage = 8;
const allCountries = await getCollection("countries");
const totalPages = Math.ceil(allCountries.length / maxPerPage);

const start = (currentPage - 1) * maxPerPage;
const visibleCountries = allCountries.slice(start, start + maxPerPage);
---

<MainLayout title={`Countries â€“ Page ${currentPage}`}>
  <HeadingSection
    title="Explore Migration Programs"
    description="Discover our curated selection of migration programs from the US to Europe and the UAE. Find your perfect residency opportunity today."
  />
  <section class="relative py-16 md:py-20 overflow-hidden">
    <div class="max-w-6xl mx-auto px-4">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        {visibleCountries.map((country) => (
          <TourCard country={country} />
        ))}
      </div>

      <div class="mt-16 flex justify-center">
        <Pagination
          currentPage={currentPage}
          totalPages={totalPages}
          basePath="/countries"
        />
      </div>
    </div>
  </section>
</MainLayout>
</MainLayout>