---
export interface TourOption {
  name: string;
  price: number;
}

export interface PackageOption {
  id: string;
  label: string;
  multiplier: number;
  description: string;
}

export interface BookingFormProps {
  tours?: TourOption[];
  packages?: PackageOption[];
  className?: string;
}

const {
  tours = [
    { name: "Tropical Reef Snorkeling", price: 79 },
    { name: "Certified Scuba Diving", price: 189 },
    { name: "Island Hopping Adventure", price: 129 },
    { name: "Whale & Dolphin Watching", price: 99 },
    { name: "Luxury Liveaboard Cruise", price: 1490 },
  ],
  packages = [
    { id: "standard", label: "Standard Package", multiplier: 1, description: "+ $0" },
    { id: "private", label: "Private Guide", multiplier: 1.6, description: "+60%" },
    { id: "premium", label: "Premium Experience", multiplier: 2.4, description: "+140%" },
  ],
  className = "",
} = Astro.props as BookingFormProps;
---

<section class={`relative py-16 md:py-20 ${className}`}>
  <div class="max-w-6xl mx-auto px-4">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-10 items-start">
      <!-- LEFT: FORM -->
      <form id="bookingForm" class="lg:col-span-2 rounded-3xl bg-white/5 border border-white/10 backdrop-blur p-8 space-y-6">
        <h2 class="text-2xl font-semibold text-white">
          Booking Details
        </h2>

        <!-- Tour -->
        <div>
          <label class="block text-sm text-white/70 mb-2">Select Tour</label>
          <select
            id="tourSelect"
            name="tour"
            required
            class="w-full rounded-xl bg-black/30 border border-white/20 px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition"
          >
            {tours.map((tour) => (
              <option value={tour.name} data-price={tour.price}>
                {tour.name} (${tour.price})
              </option>
            ))}
          </select>
        </div>

        <!-- Date & Guests -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm text-white/70 mb-2">Travel Date</label>
            <input
              type="date"
              name="date"
              required
              class="w-full rounded-xl bg-black/30 border border-white/20 px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition"
            />
          </div>

          <div>
            <label class="block text-sm text-white/70 mb-2">Number of Guests</label>
            <input
              id="guestInput"
              type="number"
              name="guests"
              min="1"
              value="1"
              required
              class="w-full rounded-xl bg-black/30 border border-white/20 px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition"
            />
          </div>
        </div>

        <!-- Package -->
        <div>
          <label class="block text-sm text-white/70 mb-2">Package Option</label>

          <div class="space-y-3">
            {packages.map((pkg, index) => (
              <div>
                <input
                  type="radio"
                  name="package"
                  value={pkg.id}
                  data-multiplier={pkg.multiplier}
                  checked={index === 0}
                  class="peer hidden"
                  id={`pkg-${pkg.id}`}
                />
                <label
                  for={`pkg-${pkg.id}`}
                  class="flex items-center justify-between rounded-xl bg-black/30 border border-white/20 peer-checked:border-blue-500 peer-checked:bg-blue-500/10 px-4 py-3 cursor-pointer transition"
                >
                  <span class="text-white">{pkg.label}</span>
                  <span class="text-white/60 text-sm">{pkg.description}</span>
                </label>
              </div>
            ))}
          </div>
        </div>

        <!-- Contact -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm text-white/70 mb-2">Full Name</label>
            <input
              type="text"
              name="fullName"
              placeholder="John Doe"
              required
              class="w-full rounded-xl bg-black/30 border border-white/20 px-4 py-3 text-white placeholder:text-white/40 focus:outline-none focus:border-blue-500 transition"
            />
          </div>

          <div>
            <label class="block text-sm text-white/70 mb-2">Email Address</label>
            <input
              type="email"
              name="email"
              placeholder="email@example.com"
              required
              class="w-full rounded-xl bg-black/30 border border-white/20 px-4 py-3 text-white placeholder:text-white/40 focus:outline-none focus:border-blue-500 transition"
            />
          </div>
        </div>

        <div>
          <label class="block text-sm text-white/70 mb-2">Phone Number</label>
          <input
            type="tel"
            name="phone"
            placeholder="+1 234 3456 7890"
            required
            class="w-full rounded-xl bg-black/30 border border-white/20 px-4 py-3 text-white placeholder:text-white/40 focus:outline-none focus:border-blue-500 transition"
          />
        </div>

        <!-- Notes -->
        <div>
          <label class="block text-sm text-white/70 mb-2">Special Requests</label>
          <textarea
            name="notes"
            rows="4"
            placeholder="Dietary needs, medical notes, etc."
            class="w-full rounded-xl bg-black/30 border border-white/20 px-4 py-3 text-white placeholder:text-white/40 focus:outline-none focus:border-blue-500 transition resize-none"
          ></textarea>
        </div>

        <button
          type="submit"
          class="w-full rounded-xl bg-white px-6 py-3 font-semibold text-black hover:bg-white/90 hover:scale-105 transition"
        >
          Confirm Booking
        </button>
      </form>

      <!-- RIGHT: SUMMARY -->
      <div class="rounded-3xl bg-white/5 border border-white/10 backdrop-blur p-6 space-y-4 lg:sticky lg:top-24">
        <h3 class="text-xl font-semibold text-white">
          Booking Summary
        </h3>

        <div class="flex justify-between text-white/70">
          <span id="summaryTour">{tours[0].name}</span>
          <span id="summaryPrice">${tours[0].price}</span>
        </div>

        <div class="flex justify-between text-white/70">
          <span>Guests</span>
          <span id="summaryGuests">1</span>
        </div>

        <div class="flex justify-between text-white/70">
          <span>Package</span>
          <span id="summaryPackage">{packages[0].label}</span>
        </div>

        <div class="border-t border-white/10 pt-4 flex justify-between text-white font-semibold text-lg">
          <span>Total</span>
          <span id="summaryTotal">${tours[0].price}</span>
        </div>

        <p class="text-sm text-white/50">
          Secure booking • No hidden fees • Trusted operators
        </p>
      </div>
    </div>
  </div>
</section>

<script>
  (() => {
    const form = document.getElementById('bookingForm') as HTMLFormElement;
    const tourSelect = document.getElementById('tourSelect') as HTMLSelectElement;
    const guestInput = document.getElementById('guestInput') as HTMLInputElement;
    const packageInputs = document.querySelectorAll('input[name="package"]') as NodeListOf<HTMLInputElement>;

    const summaryTour = document.getElementById('summaryTour');
    const summaryPrice = document.getElementById('summaryPrice');
    const summaryGuests = document.getElementById('summaryGuests');
    const summaryPackage = document.getElementById('summaryPackage');
    const summaryTotal = document.getElementById('summaryTotal');

    function updateSummary() {
      // Get selected tour
      const selectedOption = tourSelect.options[tourSelect.selectedIndex];
      const tourName = selectedOption.value;
      const basePrice = parseFloat(selectedOption.dataset.price || '0');

      // Get guests
      const guests = parseInt(guestInput.value) || 1;

      // Get package multiplier
      const selectedPackage = Array.from(packageInputs).find(input => input.checked);
      const multiplier = parseFloat(selectedPackage?.dataset.multiplier || '1');
      const packageLabel = selectedPackage?.nextElementSibling?.querySelector('span')?.textContent || 'Standard';

      // Calculate total
      const total = basePrice * guests * multiplier;

      // Update summary
      if (summaryTour) summaryTour.textContent = tourName;
      if (summaryPrice) summaryPrice.textContent = `$${basePrice}`;
      if (summaryGuests) summaryGuests.textContent = guests.toString();
      if (summaryPackage) summaryPackage.textContent = packageLabel;
      if (summaryTotal) summaryTotal.textContent = `$${total.toFixed(2)}`;
    }

    // Event listeners
    tourSelect?.addEventListener('change', updateSummary);
    guestInput?.addEventListener('input', updateSummary);
    packageInputs.forEach(input => input.addEventListener('change', updateSummary));

    // Form submission
    form?.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      
      console.log('Booking submitted:', data);
      
      // Here you can send data to your API
      alert('Booking submitted successfully! Check console for details.');
      
      // Optional: Reset form
      // form.reset();
      // updateSummary();
    });

    // Initial update
    updateSummary();
  })();
</script>