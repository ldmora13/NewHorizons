---
import TourCard from "@src/components/TourCard.astro";
import { getCollection } from "astro:content";

/* =========================
   Types
========================= */
export interface TourSectionProps {
  id?: string;
  title: string;
  description?: string;
  maxCountries?: number;
}

/* =========================
   Props & Defaults
========================= */
const {
  id = "countries",
  title = "Popular Countries to Live In",
  description = "Discover our most loved countries to live in, carefully curated for international inmigrants.",
  maxCountries = 8,
} = Astro.props as TourSectionProps;

/* =========================
   Fetch & Prepare Countries
========================= */
const countries = await getCollection("countries");

  const sortedCountries = countries.sort((a, b) => {
  const investmentA = a.data.investment || 0;
  const investmentB = b.data.investment || 0;
  return investmentA - investmentB;
});

// Limit countries
const visibleCountries = sortedCountries.slice(0, maxCountries);
---

<!-- Countries Section -->
<section id={id} class="relative py-16 md:py-20 overflow-hidden">
  
  <div class="max-w-6xl mx-auto px-4 relative">

    <!-- Heading -->
    <div class="mb-12 text-center">
      <h2 class="text-3xl md:text-4xl font-semibold text-white">
        {title}
      </h2>

      {description && (
        <p class="mt-3 text-white/70 max-w-2xl mx-auto">
          {description}
        </p>
      )}
    </div>

    <!-- Countries Grid -->
    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {visibleCountries.map((country) => (
        <TourCard country={country} />
      ))}
    </div>
  </div>
</section>